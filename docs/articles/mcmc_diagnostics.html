<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>MCMC Diagnostics • BGGM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MCMC Diagnostics">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BGGM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.3.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/donaldRwilliams/BGGM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>MCMC Diagnostics</h1>
                        <h4 data-toc-skip class="author">Donny
Williams</h4>
            
            <h4 data-toc-skip class="date">5/20/2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/donaldRwilliams/BGGM/blob/HEAD/vignettes/mcmc_diagnostics.Rmd" class="external-link"><code>vignettes/mcmc_diagnostics.Rmd</code></a></small>
      <div class="d-none name"><code>mcmc_diagnostics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The algorithms in <strong>BGGM</strong> are based on Gibbs samplers.
In the context of covariance matrix estimation, as opposed, to, say,
hierarchical models, this allows for efficiently sampling the posterior
distribution. Furthermore, in all samplers the empirical covariance
matrix is used as the starting value which reduces the length of the
burn-in (or warm-up). Still yet it is important to monitor convergence.
See <a href="https://sbfnk.github.io/mfiidd/mcmc_diagnostics.html" class="external-link">here</a> for
an introduction to MCMC diagnostics.</p>
<div class="section level4">
<h4 id="r-packages">R packages<a class="anchor" aria-label="anchor" href="#r-packages"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># need the developmental version</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>   </span>
<span><span class="op">}</span>   </span>
<span></span>
<span><span class="co"># install from github</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"donaldRwilliams/BGGM"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://donaldrwilliams.github.io/BGGM">BGGM</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="acf-plot">ACF plot<a class="anchor" aria-label="anchor" href="#acf-plot"></a>
</h2>
<p>This first example includes an “acf” plot that looks at the auto
correlation of the samples. In general, we do not want the samples to be
strongly correlated or related to the previous samples (or lags
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>).
I am not sure there are general guidelines, but typically we do not want
“auto correlation…for higher values of k, [because] this indicates a
high degree of correlation between our samples and slow mixing” <a href="https://sbfnk.github.io/mfiidd/mcmc_diagnostics.html" class="external-link">source</a></p>
<p>Here is an example for ordinal data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">ptsd</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="co"># + 1 makes first category a 1</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">+</span> <span class="fl">1</span>, type <span class="op">=</span> <span class="st">"ordinal"</span><span class="op">)</span></span></code></pre></div>
<p>To check the convergence of a partial correlation, we need the
parameter name. These are printed as follows</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/convergence.html">convergence</a></span><span class="op">(</span><span class="va">fit</span>, print_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt;  [1] "B1--B2"         "B1--B3"         "B2--B3"         "B1--B4"         "B2--B4"         "B3--B4"         "B1--B5"        </span></span>
<span><span class="co">#&gt;  [8] "B2--B5"         "B3--B5"         "B4--B5"         "B1--C1"         "B2--C1"         "B3--C1"         "B4--C1"        </span></span>
<span><span class="co">#&gt; [15] "B5--C1"         "B1--C2"         "B2--C2"         "B3--C2"         "B4--C2"         "B5--C2"         "C1--C2"        </span></span>
<span><span class="co">#&gt; [22] "B1--D1"         "B2--D1"         "B3--D1"         "B4--D1"         "B5--D1"         "C1--D1"         "C2--D1"        </span></span>
<span><span class="co">#&gt; [29] "B1--D2"         "B2--D2"         "B3--D2"         "B4--D2"         "B5--D2"         "C1--D2"         "C2--D2"        </span></span>
<span><span class="co">#&gt; [36] "D1--D2"         "B1--D3"         "B2--D3"         "B3--D3"         "B4--D3"         "B5--D3"         "C1--D3"        </span></span>
<span><span class="co">#&gt; [43] "C2--D3"         "D1--D3"         "D2--D3"         "B1_(Intercept)" "B2_(Intercept)" "B3_(Intercept)" "B4_(Intercept)"</span></span>
<span><span class="co">#&gt; [50] "B5_(Intercept)" "C1_(Intercept)" "C2_(Intercept)" "D1_(Intercept)" "D2_(Intercept)" "D3_(Intercept)"</span></span></code></pre></div>
<p>Note the <code>(Intercept)</code> which reflect the fact that the
ordinal approach is a multivariate probit model with only
intercepts.</p>
<p>The next step is to make the plot</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/convergence.html">convergence</a></span><span class="op">(</span><span class="va">fit</span>, param <span class="op">=</span> <span class="st">"B1--B2"</span>, type <span class="op">=</span> <span class="st">"acf"</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/acf_new2.png"></p>
<p>The argument <code>param</code> can take any number of parameters and
a plot will be made for each (e.g..,
<code>param = c("B1--B2", B1--B3)</code>). In this case, the auto
correlations looks acceptable and actually really good (note the drop to
zero). A problematic <code>acf</code> plot would have the black lines
start at <code>1.0</code> and perhaps never go below
<code>0.20</code>.</p>
<p>To make this clear, I simulated time series data taking the code from
<a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/arima.sim.html" class="external-link">here</a></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sim time series</span></span>
<span><span class="va">ts.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/arima.sim.html" class="external-link">arima.sim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, ar <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html" class="external-link">acf</a></span><span class="op">(</span><span class="va">ts.sim</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/acf_problem.png"></p>
<p>This would be considered problematic. If this occurs, one solution
could be to thin the samples manually</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract samples</span></span>
<span><span class="va">samps</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">post_samp</span><span class="op">$</span><span class="va">pcors</span></span>
<span></span>
<span><span class="co"># iterations</span></span>
<span><span class="va">iter</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">iter</span></span>
<span></span>
<span><span class="co"># thinning interval </span></span>
<span><span class="va">thin</span> <span class="op">&lt;-</span>  <span class="fl">5</span></span>
<span></span>
<span><span class="co"># save every 5th (add 50 which is the burnin)</span></span>
<span><span class="va">new_iter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,to <span class="op">=</span> <span class="va">iter</span> <span class="op">+</span> <span class="fl">50</span> , by <span class="op">=</span> <span class="va">thin</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># replace (add 50 which is the burnin)</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">post_samp</span><span class="op">$</span><span class="va">pcors</span> <span class="op">&lt;-</span> <span class="va">samps</span><span class="op">[</span>,,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,to <span class="op">=</span> <span class="va">iter</span> <span class="op">+</span> <span class="fl">50</span>, by <span class="op">=</span> <span class="va">thin</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># replace iter</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">iter</span> <span class="op">&lt;-</span> <span class="va">new_iter</span> <span class="op">-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co"># check thinned</span></span>
<span><span class="fu"><a href="../reference/convergence.html">convergence</a></span><span class="op">(</span><span class="va">fit</span>, param <span class="op">=</span> <span class="st">"B1--B2"</span>, type <span class="op">=</span> <span class="st">"acf"</span><span class="op">)</span></span></code></pre></div>
<p>or perhaps just running the model for more iterations (e.g.,
increasing <code>iter</code> in <code>estimate</code>). The above is
quite convoluted but note convergence should not typically be an issue.
And it might come in handy to know that the samples can be replaced and
the other functions in <strong>BGGM</strong> will still work with the
object <code>fit</code>.</p>
</div>
<div class="section level2">
<h2 id="trace-plot">Trace plot<a class="anchor" aria-label="anchor" href="#trace-plot"></a>
</h2>
<p>The next example is a trace plot. Here we are looking for good
“mixing”.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/convergence.html">convergence</a></span><span class="op">(</span><span class="va">fit</span>, param <span class="op">=</span> <span class="st">"B1--B2"</span>, type <span class="op">=</span> <span class="st">"trace"</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/trace.png"></p>
<p>Admittedly the term “mixing” is vague. But in general the plot should
look like this example, where there is no place that the chain is
“stuck”. See <a href="https://stats.stackexchange.com/questions/311151/evaluation-of-mcmc-samples" class="external-link">here</a>
for problematic trace plots.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Donald Williams, Joris Mulder, Philippe Rast.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
